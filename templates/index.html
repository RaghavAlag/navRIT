<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Navigator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2a9d8f;
            --secondary-color: #264653;
            --accent-color: #e76f51;
            --background-color: #f8f9fa;
            --card-color: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--secondary-color);
        }

        .content-wrapper {
            display: flex;
            gap: 2rem;
            max-width: 1400px;
            width: 100%;
        }

        .controls-container {
            flex: 1;
            background-color: var(--card-color);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .map-container {
            flex: 2;
            background-color: var(--card-color);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            min-height: 600px;
            display: flex;
            flex-direction: column;
        }

        .input-group {
            margin-bottom: 1.5rem;
            position: relative;
        }
        :root {
        --primary-color: #2a9d8f;
        --secondary-color: #2a9d8f;
        --accent-color: #e76f51;
        --background-color: #f8f9fa; /* Light mode background */
        --card-color: #ffffff; /* Light mode card color */
    }

    .dark-mode {
        --primary-color: #2a9d8f;
        --secondary-color: #2a9d8f;
        --accent-color: #e63946;
        --background-color: #2a2a2a; /* Dark mode background */
        --card-color: #4a4a4a; /* Dark mode card color */
    }

        .input-group i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-color);
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--secondary-color);
            font-weight: 600;
        }

        select {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            appearance: none;
            background: #fff url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%232a9d8f' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E") no-repeat right 1rem center;
        }

        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(42, 157, 143, 0.1);
        }

        button {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            width: 100%;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        button:hover {
            background-color: #238276;
            transform: translateY(-1px);
        }

        .directions-container {
            margin-top: 2rem;
            padding: 1.5rem;
            border-radius: 8px;
            background-color: #f8f9fa;
            border: 2px solid #e0e0e0;
            max-height: 400px;
            overflow-y: auto;
        }

        .map-svg {
            width: 100%;
            height: 500px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .room-node {
            fill: var(--secondary-color);
            r: 8;
            transition: all 0.3s ease;
            opacity: 0.7;
        }

        .room-node.active {
            fill: var(--accent-color);
            r: 10;
            opacity: 1;
        }

        .room-label {
            font-size: 12px;
            fill: var(--secondary-color);
            opacity: 0.7;
        }

        .room-label.active {
            opacity: 1;
            font-weight: bold;
        }

        .path-line {
            stroke: var(--accent-color);
            stroke-width: 3;
            stroke-dasharray: 5;
            animation: dash 1s linear infinite;
        }

        .stairs-icon {
            fill: var(--primary-color);
        }

        .direction-step {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.5rem;
            border-bottom: 1px solid #e0e0e0;
        }

        .step-number {
            background-color: var(--primary-color);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .step-icon {
            color: var(--primary-color);
            font-size: 1.2rem;
        }

        @keyframes dash {
            to {
                stroke-dashoffset: -10;
            }
        }

        @media (max-width: 1024px) {
            .content-wrapper {
                flex-direction: column;
            }

            .controls-container, .map-container {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Campus Navigator</h1>
        <p>Find your way around campus with our interactive map</p>
        <button id="theme-toggle" class="toggle-button">Switch to Dark Mode</button>
    </div>

    <div class="content-wrapper">
        <div class="controls-container">
            <div class="input-group">
                <label for="start-room">Current Location</label>
                <i class="fas fa-map-marker-alt"></i>
                <select id="start-room">
                    <option value="">Select Starting Room</option>
                    <option value="G01">G01 - Main Entrance</option>
                    <option value="G02">G02 - Reception</option>
                    <option value="G03">G03 - Cafeteria</option>
                    <option value="G04">G04 - Library</option>
                    <option value="101">101 - Computer Lab</option>
                    <option value="102">102 - Physics Lab</option>
                    <option value="103">103 - Chemistry Lab</option>
                    <option value="104">104 - Classroom</option>
                </select>
            </div>

            <div class="input-group">
                <label for="end-room">Destination</label>
                <i class="fas fa-location-dot"></i>
                <select id="end-room">
                    <option value="">Select Destination Room</option>
                    <option value="G01">G01 - Main Entrance</option>
                    <option value="G02">G02 - Reception</option>
                    <option value="G03">G03 - Cafeteria</option>
                    <option value="G04">G04 - Library</option>
                    <option value="101">101 - Computer Lab</option>
                    <option value="102">102 - Physics Lab</option>
                    <option value="103">103 - Chemistry Lab</option>
                    <option value="104">104 - Classroom</option>
                </select>
            </div>

            <button onclick="getDirections()">
                <i class="fas fa-directions"></i>
                Get Directions
            </button>

            <div class="directions-container">
                <div id="directions">
                    Select your current location and destination to get directions.
                </div>
            </div>
        </div>

        <div class="map-container">
            <svg class="map-svg" viewBox="0 0 600 500"></svg>
        </div>
    </div>

    <script>
        // SVG namespace
        const SVG_NS = "http://www.w3.org/2000/svg";

        // Stairs icon path data
        const STAIRS_ICON = "M 0,0 L 2,0 L 2,-2 L 4,-2 L 4,-4 L 6,-4 L 6,-6 L 8,-6";

        function createStairsIcon(x1, y1, x2, y2) {
            const group = document.createElementNS(SVG_NS, 'g');
            const midX = (x1 + x2) / 2;
            const midY = (y1 + y2) / 2;
            
            const path = document.createElementNS(SVG_NS, 'path');
            path.setAttribute('d', STAIRS_ICON);
            path.setAttribute('class', 'stairs-icon');
            path.setAttribute('transform', `translate(${midX-4},${midY+3}) scale(2)`);
            
            group.appendChild(path);
            return group;
        }

        function drawMap(data) {
            const svg = document.querySelector('.map-svg');
            svg.innerHTML = ''; // Clear previous content
            
            // Create groups
            const pathsGroup = document.createElementNS(SVG_NS, 'g');
            const roomsGroup = document.createElementNS(SVG_NS, 'g');
            const labelsGroup = document.createElementNS(SVG_NS, 'g');
            const stairsGroup = document.createElementNS(SVG_NS, 'g');
            
            // Draw paths
            data.relevant_paths.forEach(({start, end, type}) => {
                const line = document.createElementNS(SVG_NS, 'line');
                line.setAttribute('x1', start.x);
                line.setAttribute('y1', start.y);
                line.setAttribute('x2', end.x);
                line.setAttribute('y2', end.y);
                line.setAttribute('class', 'path-line');
                pathsGroup.appendChild(line);

                if (type === 'stairs') {
                    const stairsIcon = createStairsIcon(start.x, start.y, end.x, end.y);
                    stairsGroup.appendChild(stairsIcon);
                }
            });

            // Draw rooms and labels
            data.path.forEach(room => {
                const circle = document.createElementNS(SVG_NS, 'circle');
                circle.setAttribute('cx', room.x);
                circle.setAttribute('cy', room.y);
                circle.setAttribute('class', 'room-node active');
                roomsGroup.appendChild(circle);

                const text = document.createElementNS(SVG_NS, 'text');
                text.setAttribute('x', parseInt(room.x) + 15);
                text.setAttribute('y', parseInt(room.y) + 5);
                text.setAttribute('class', 'room-label active');
                text.textContent = `${room.id} - ${room.description}`;
                labelsGroup.appendChild(text);
            });

            // Add all groups to SVG
            svg.appendChild(pathsGroup);
            svg.appendChild(stairsGroup);
            svg.appendChild(roomsGroup);
            svg.appendChild(labelsGroup);
        }

        function updateDirections(directions) {
            const directionsDiv = document.getElementById('directions');
            if (directions && directions.length > 0) {
                const directionsList = directions.map((step, index) => {
                    let iconClass = 'fa-person-walking';
                    if (step.toLowerCase().includes('stairs')) {
                        iconClass = 'fa-stairs';
                    }
                    
                    return `
                        <div class="direction-step">
                            <div class="step-number">${index + 1}</div>
                            <i class="fas ${iconClass} step-icon"></i>
                            <div>${step}</div>
                        </div>
                    `;
                }).join('');
                directionsDiv.innerHTML = directionsList;
            } else {
                directionsDiv.innerHTML = 'Select your current location and destination to get directions.';
            }
        }

        function getDirections() {
            const startRoom = document.getElementById('start-room').value;
            const endRoom = document.getElementById('end-room').value;
            
            if (!startRoom || !endRoom) {
                alert('Please select both rooms');
                return;
            }
            
            fetch('/get_directions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    start: startRoom,
                    end: endRoom
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    document.getElementById('directions').innerHTML = data.error;
                    return;
                }
                drawMap(data);
                updateDirections(data.directions);
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('directions').innerHTML = 
                    'Error getting directions. Please try again.';
            });
        }

        // Initialize empty map on page load
        window.onload = function() {
            const startRoom = document.getElementById('start-room');
            const endRoom = document.getElementById('end-room');
            if (startRoom.value && endRoom.value) {
                getDirections();
            }
        };
        document.getElementById('theme-toggle').addEventListener('click', function() {
    document.body.classList.toggle('dark-mode');
    
    // Change button text based on the current mode
    if (document.body.classList.contains('dark-mode')) {
        this.textContent = 'Switch to Light Mode';
    } else {
        this.textContent = 'Switch to Dark Mode';
    }
});
    </script>
</body>
</html>